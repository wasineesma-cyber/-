<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>บัญชีส่วนตัว Pro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#ffffff;
  --card:#f4f4f5;
  --text:#111827;
  --sub:#6b7280;
  --border:#e5e7eb;
  --accent:#6366f1;
}
body.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#e5e7eb;
  --sub:#9ca3af;
  --border:#2a2a2a;
  --accent:#818cf8;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
}
header{
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid var(--border);
}
h1{font-size:1.4rem}
.container{max-width:900px;margin:auto;padding:20px 16px 40px}
button{
  cursor:pointer;
  border:none;
  border-radius:10px;
}
.btn{
  padding:8px 14px;
  background:var(--accent);
  color:#fff;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}
.summary{display:grid;gap:12px;margin-bottom:20px}
.amount{font-size:1.4rem;font-weight:600}
.income{color:#22c55e}
.expense{color:#ef4444}
.balance{color:#3b82f6}
.form-group{display:flex;flex-direction:column;margin-bottom:12px}
label{font-size:.85rem;color:var(--sub);margin-bottom:4px}
input,select{
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--bg);
  color:var(--text);
}
.tx-item{
  display:flex;
  justify-content:space-between;
  padding:10px 0;
  border-bottom:1px solid var(--border);
}
.account-bar{
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom:16px;
  flex-wrap:wrap;
}
canvas{margin-top:20px}
</style>
</head>

<body class="dark">

<header>
  <h1>บัญชีส่วนตัว</h1>
  <div>
    <button class="btn" onclick="toggleTheme()">สลับธีม</button>
  </div>
</header>

<div class="container">

<div class="account-bar">
  <select id="accountSelect" onchange="switchAccount()"></select>
  <button class="btn" onclick="addAccount()">+ เพิ่มบัญชี</button>
  <button class="btn" onclick="deleteAccount()">ลบบัญชี</button>
</div>

<div class="summary">
  <div class="card">
    <div>รายรับเดือนนี้</div>
    <div id="totalIncome" class="amount income">฿0</div>
  </div>
  <div class="card">
    <div>รายจ่ายเดือนนี้</div>
    <div id="totalExpense" class="amount expense">฿0</div>
  </div>
  <div class="card">
    <div>คงเหลือ</div>
    <div id="totalBalance" class="amount balance">฿0</div>
  </div>
</div>

<div class="card">
  <div class="form-group">
    <label>ประเภท</label>
    <select id="type">
      <option value="income">รายรับ</option>
      <option value="expense">รายจ่าย</option>
    </select>
  </div>
  <div class="form-group">
    <label>จำนวนเงิน</label>
    <input type="number" id="amount">
  </div>
  <div class="form-group">
    <label>หมวดหมู่</label>
    <input type="text" id="category">
  </div>
  <div class="form-group">
    <label>วันที่</label>
    <input type="date" id="date">
  </div>
  <div class="form-group">
    <label>รายละเอียด</label>
    <input type="text" id="desc">
  </div>
  <button class="btn" onclick="addEntry()">บันทึก</button>
</div>

<div class="card">
  <h3>ประวัติ</h3>
  <div id="txList"></div>
</div>

<div class="card">
  <h3>กราฟรายรับ/รายจ่าย</h3>
  <canvas id="barChart" height="120"></canvas>
</div>

<div class="card">
  <h3>สัดส่วนรายจ่าย</h3>
  <canvas id="pieChart" height="120"></canvas>
</div>

</div>

<script>
let accounts=JSON.parse(localStorage.getItem('accounts')||'{"บัญชีหลัก":[]}');
let currentAccount=localStorage.getItem('currentAccount')||'บัญชีหลัก';
let barChart,pieChart;

function save(){
  localStorage.setItem('accounts',JSON.stringify(accounts));
  localStorage.setItem('currentAccount',currentAccount);
}

function toggleTheme(){
  document.body.classList.toggle('dark');
}

function renderAccounts(){
  accountSelect.innerHTML=Object.keys(accounts)
  .map(a=>`<option ${a===currentAccount?'selected':''}>${a}</option>`)
  .join('');
}

function switchAccount(){
  currentAccount=accountSelect.value;
  save();
  render();
}

function addAccount(){
  const name=prompt("ชื่อบัญชีใหม่");
  if(!name)return;
  accounts[name]=[];
  currentAccount=name;
  save();
  renderAccounts();
  render();
}

function deleteAccount(){
  if(!confirm("ลบบัญชีนี้?"))return;
  delete accounts[currentAccount];
  currentAccount=Object.keys(accounts)[0];
  save();
  renderAccounts();
  render();
}

function addEntry(){
  const entry={
    id:Date.now(),
    type:type.value,
    amount:parseFloat(amount.value),
    category:category.value,
    date:date.value,
    desc:desc.value||category.value
  };
  if(!entry.amount||!entry.date)return;
  accounts[currentAccount].push(entry);
  save();
  amount.value='';desc.value='';
  render();
}

function render(){
  const data=accounts[currentAccount]||[];
  const ym=new Date().toISOString().slice(0,7);
  const month=data.filter(e=>e.date.startsWith(ym));
  const income=month.filter(e=>e.type==='income')
  .reduce((s,e)=>s+e.amount,0);
  const expense=month.filter(e=>e.type==='expense')
  .reduce((s,e)=>s+e.amount,0);

  totalIncome.textContent='฿'+income.toLocaleString();
  totalExpense.textContent='฿'+expense.toLocaleString();
  totalBalance.textContent='฿'+(income-expense).toLocaleString();

  txList.innerHTML=month.map(e=>`
    <div class="tx-item">
      <div>${e.desc}<br><small>${e.category} • ${e.date}</small></div>
      <div class="${e.type==='income'?'income':'expense'}">
      ${e.type==='income'?'+':'-'}฿${e.amount.toLocaleString()}</div>
    </div>
  `).join('');

  renderCharts(month);
}

function renderCharts(data){
  const income=data.filter(e=>e.type==='income')
  .reduce((s,e)=>s+e.amount,0);
  const expense=data.filter(e=>e.type==='expense')
  .reduce((s,e)=>s+e.amount,0);

  if(barChart)barChart.destroy();
  barChart=new Chart(barChartCanvas,{
    type:'bar',
    data:{
      labels:['รายรับ','รายจ่าย'],
      datasets:[{data:[income,expense],
      backgroundColor:['#22c55e','#ef4444']}]
    }
  });

  const catMap={};
  data.filter(e=>e.type==='expense')
  .forEach(e=>catMap[e.category]=(catMap[e.category]||0)+e.amount);

  if(pieChart)pieChart.destroy();
  pieChart=new Chart(pieChartCanvas,{
    type:'doughnut',
    data:{
      labels:Object.keys(catMap),
      datasets:[{
        data:Object.values(catMap),
        backgroundColor:['#6366f1','#f59e0b','#10b981','#ef4444','#3b82f6']
      }]
    }
  });
}

document.getElementById('date').value=new Date().toISOString().slice(0,10);
const barChartCanvas=document.getElementById('barChart');
const pieChartCanvas=document.getElementById('pieChart');

renderAccounts();
render();
</script>

</body>
</html>