<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>ÎèàÎÖ∏Ìä∏ Don Note ‚≠ê</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
/* --- ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏µ‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö (‡∏ú‡∏°‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô Login ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß) --- */
:root {
  --pink: #C17A3C; --pink-light: #FFF3E8; --pink-border:#E8B87A; --pink-track: #F5D5A0;
  --teal: #00C9A7; --teal-light: #E8FAF7; --teal-border:#80E5D8; --teal-track: #B2F0E8;
  --bg: #FBF7F2; --white: #FFFFFF; --text: #1C1C1E; --sub: #8E8E93; --border: #E5E5EA; --nav-h: 60px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:-apple-system,sans-serif;}
body{padding-bottom:var(--nav-h);}

/* ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Login ‡∏ú‡πà‡∏≤‡∏ô LINE */
.liff-login-overlay { position:fixed; inset:0; z-index:20000; background:var(--bg); display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; }
.btn-line { background:#06C755; color:white; border:none; padding:15px 30px; border-radius:15px; font-weight:bold; font-size:1.1rem; cursor:pointer; margin-top:20px; display:flex; align-items:center; gap:10px; }

/* CSS ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ú‡∏°‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏™‡∏ß‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏£‡∏±‡∏ö */
.header{ background:var(--white); padding:12px 18px; display:flex; align-items:center; justify-content:center; position:relative; }
.bottom-nav{ position:fixed; bottom:0; left:0; right:0; height:var(--nav-h); background:var(--white); border-top:1px solid var(--border); display:grid; grid-template-columns:repeat(5,1fr); z-index:100; }
.nav-btn{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:3px; background:none; border:none; color:var(--sub); font-size:.58rem; font-weight:600; }
.nav-btn.active{color:var(--pink);}
.panel{display:none; max-width:480px; margin:0 auto; padding:14px;}
.panel.active{display:block;}
.hidden { display:none !important; }
/* ... (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡∏ã‡∏∂‡πà‡∏á CSS ‡∏™‡∏ß‡∏¢‡πÜ ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ... */
</style>
</head>
<body>

<div id="liffLoginScreen" class="liff-login-overlay">
  <div style="font-size: 5rem;">üêª</div>
  <h2 style="color:var(--pink);">Don Note</h2>
  <p style="color:var(--sub); margin-top:10px;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏µ<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
  <button class="btn-line" onclick="liff.login()">
    <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" width="20"> Login with LINE
  </button>
</div>

<div id="appBody" class="hidden">
    <div class="header">
      <div class="header-bear">üêª</div>
      <div class="header-title" id="userNameTitle">Don Note ‚≠ê</div>
    </div>

    <div class="panel active" id="panel-home">
        <div style="text-align:center; margin-bottom:20px;">
            <div style="font-size:0.8rem; color:var(--sub);">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏Å‡πá‡∏ö</div>
            <div id="balAmount" style="font-size:2.5rem; font-weight:900;">‡∏ø0</div>
        </div>
        <div id="catRows"></div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-btn active" onclick="goPanel('panel-home')">üè†‡∏™‡∏£‡∏∏‡∏õ</button>
        <button class="nav-btn" onclick="goPanel('panel-add')">‚úèÔ∏è‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="nav-btn" onclick="goPanel('panel-history')">üìã‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    </nav>
</div>

<script>
// 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏µ)
const firebaseConfig = {// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAOAr6OsQpf_e-xv8qfLyIUu6Dant1MkS4",
  authDomain: "don-note.firebaseapp.com",
  projectId: "don-note",
  storageBucket: "don-note.firebasestorage.app",
  messagingSenderId: "661381674055",
  appId: "1:661381674055:web:0427dc17348fb11b56ed62",
  measurementId: "G-JSFQLQ03ZV"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LIFF ID (‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏µ‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö)
const MY_LIFF_ID = "2009225343-VWodtDEA"; 

let userId = "";
let entries = [];

// 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏ä‡πá‡∏Ñ LINE ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
async function initLiff() {
    try {
        await liff.init({ liffId: MY_LIFF_ID });
        if (liff.isLoggedIn()) {
            const profile = await liff.getProfile();
            userId = profile.userId; // ‡πÉ‡∏ä‡πâ LINE User ID ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            
            document.getElementById('liffLoginScreen').classList.add('hidden');
            document.getElementById('appBody').classList.remove('hidden');
            document.getElementById('userNameTitle').textContent = profile.displayName + " ‚≠ê";
            
            loadData(); // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
        } else {
            // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà Login ‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÑ‡∏ß‡πâ
            document.getElementById('liffLoginScreen').classList.remove('hidden');
        }
    } catch (err) {
        console.error("LIFF Init Error", err);
    }
}

// 4. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
async function loadData() {
    db.collection("dongNote").doc(userId).get().then((doc) => {
        if (doc.exists) {
            entries = doc.data().entries || [];
            renderAll(); // ‡∏™‡∏±‡πà‡∏á‡∏ß‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏°‡πà
        }
    });
}

// 5. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
async function saveData() {
    await db.collection("dongNote").doc(userId).set({
        entries: entries,
        updatedAt: new Date().toISOString()
    });
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ (goPanel, renderAll) ‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏µ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö

function goPanel(id) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
initLiff();
</script>

</body>
</html>
