<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ÎèàÎÖ∏Ìä∏ Don Note ‚≠ê</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --pink: #C17A3C; --pink-light: #FFF3E8; --pink-border:#E8B87A; --pink-track: #F5D5A0;
            --teal: #00C9A7; --teal-light: #E8FAF7; --teal-border:#80E5D8; --teal-track: #B2F0E8;
            --bg: #FBF7F2; --white: #FFFFFF; --text: #1C1C1E; --sub: #8E8E93; --border: #E5E5EA; --nav-h: 70px;
        }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html, body { height:100%; background:var(--bg); color:var(--text); font-family:-apple-system, sans-serif; overflow: hidden; }
        body { display: flex; flex-direction: column; }

        /* ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Login */
        .liff-login-overlay { position:fixed; inset:0; z-index:20000; background:var(--bg); display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; }
        .btn-line { background:#06C755; color:white; border:none; padding:15px 30px; border-radius:15px; font-weight:bold; font-size:1.1rem; cursor:pointer; margin-top:20px; display:flex; align-items:center; gap:10px; }

        /* Header ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏µ */
        .header { background:var(--white); padding:15px 20px; display:flex; align-items:center; justify-content:center; position:relative; border-bottom:1px solid var(--border); }
        .header-bear { font-size: 1.5rem; margin-right: 10px; }
        .header-title { font-weight: 800; font-size: 1.2rem; letter-spacing: -0.5px; }

        /* Main Content */
        .main-content { flex: 1; overflow-y: auto; padding-bottom: 20px; }
        .panel { display:none; max-width:480px; margin:0 auto; padding:20px; }
        .panel.active { display:block; }

        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î */
        .balance-section { text-align:center; padding:30px 0; }
        .bal-label { font-size:0.85rem; color:var(--sub); font-weight:600; margin-bottom:5px; }
        .bal-amount { font-size:3rem; font-weight:900; letter-spacing:-1px; }

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏µ‡∏ä‡∏≠‡∏ö) */
        .cat-table { background:var(--white); border-radius:24px; padding:10px; border:1px solid var(--border); }
        .cat-row { display:flex; align-items:center; padding:12px 15px; border-bottom:1px solid #F5F5F7; }
        .cat-row:last-child { border-bottom:none; }
        .cat-icon { width:40px; height:40px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.2rem; margin-right:12px; }
        .cat-info { flex:1; }
        .cat-name { font-weight:700; font-size:0.95rem; }
        .cat-bar-bg { height:6px; background:#F2F2F7; border-radius:3px; margin-top:6px; overflow:hidden; }
        .cat-bar-fill { height:100%; border-radius:3px; }
        .cat-val { text-align:right; font-weight:700; font-size:0.95rem; }

        /* Nav ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
        .bottom-nav { height:var(--nav-h); background:rgba(255,255,255,0.8); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-top:1px solid var(--border); display:grid; grid-template-columns:repeat(3,1fr); padding-bottom: env(safe-area-inset-bottom); }
        .nav-btn { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px; background:none; border:none; color:var(--sub); font-size:0.7rem; font-weight:700; transition: 0.2s; }
        .nav-btn.active { color:var(--pink); }
        .nav-icon { font-size: 1.4rem; }

        .hidden { display:none !important; }
    </style>
</head>
<body>

<div id="liffLoginScreen" class="liff-login-overlay">
    <div style="font-size: 5rem;">üêª</div>
    <h2 style="color:var(--pink);">Don Note</h2>
    <p style="color:var(--sub); margin-top:10px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
    <button class="btn-line" onclick="liff.login()">Login with LINE</button>
</div>

<div id="appBody" class="hidden" style="height: 100%; display: flex; flex-direction: column;">
    <div class="header">
        <span class="header-bear">üêª</span>
        <span class="header-title" id="userNameTitle">Don Note ‚≠ê</span>
    </div>

    <div class="main-content">
        <div class="panel active" id="panel-home">
            <div class="balance-section">
                <div class="bal-label">‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="bal-amount" id="balAmount">‡∏ø0</div>
            </div>

            <div class="cat-table">
                <div class="cat-row">
                    <div class="cat-icon" style="background:var(--pink-light);">üí∞</div>
                    <div class="cat-info">
                        <div class="cat-name">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</div>
                        <div class="cat-bar-bg"><div class="cat-bar-fill" style="width:70%; background:var(--pink);"></div></div>
                    </div>
                    <div class="cat-val" style="color:var(--pink);">‡∏ø0</div>
                </div>
                <div class="cat-row">
                    <div class="cat-icon" style="background:var(--teal-light);">üí∏</div>
                    <div class="cat-info">
                        <div class="cat-name">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</div>
                        <div class="cat-bar-bg"><div class="cat-bar-fill" style="width:40%; background:var(--teal);"></div></div>
                    </div>
                    <div class="cat-val" style="color:var(--teal);">‡∏ø0</div>
                </div>
            </div>
        </div>

        <div class="panel" id="panel-add">
            <h3 style="text-align:center;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà</h3>
        </div>

        <div class="panel" id="panel-history">
            <h3 style="text-align:center;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-btn active" onclick="goPanel('panel-home', this)">
            <span class="nav-icon">üè†</span><span>‡∏™‡∏£‡∏∏‡∏õ</span>
        </button>
        <button class="nav-btn" onclick="goPanel('panel-add', this)">
            <span class="nav-icon">‚úèÔ∏è</span><span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
        </button>
        <button class="nav-btn" onclick="goPanel('panel-history', this)">
            <span class="nav-icon">üìã</span><span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
        </button>
    </nav>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAOAr6OsQpf_e-xv8qfLyIUu6Dant1MkS4",
    authDomain: "don-note.firebaseapp.com",
    projectId: "don-note",
    storageBucket: "don-note.firebasestorage.app",
    messagingSenderId: "661381674055",
    appId: "1:661381674055:web:0427dc17348fb11b56ed62"
};

if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const MY_LIFF_ID = "2009225343-VWodtDEA"; 

let userId = "";

async function initLiff() {
    try {
        await liff.init({ liffId: MY_LIFF_ID });
        if (liff.isLoggedIn()) {
            const profile = await liff.getProfile();
            userId = profile.userId;
            document.getElementById('liffLoginScreen').classList.add('hidden');
            document.getElementById('appBody').style.display = 'flex';
            document.getElementById('userNameTitle').textContent = profile.displayName + " ‚≠ê";
            loadData();
        }
    } catch (err) { console.error(err); }
}

function goPanel(id, btn) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

async function loadData() {
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase ‡∏°‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    const doc = await db.collection("dongNote").doc(userId).get();
    if (doc.exists) {
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
    }
}

initLiff();
</script>
</body>
</html>
