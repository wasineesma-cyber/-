<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ÎèàÎÖ∏Ìä∏ Don Note ‚≠ê</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --pink: #C17A3C; --pink-light: #FFF3E8; --pink-border:#E8B87A; --pink-track: #F5D5A0;
            --teal: #00C9A7; --teal-light: #E8FAF7; --teal-border:#80E5D8; --teal-track: #B2F0E8;
            --bg: #FBF7F2; --white: #FFFFFF; --text: #1C1C1E; --sub: #8E8E93; --border: #E5E5EA; --nav-h: 70px;
        }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html, body { height:100%; background:var(--bg); color:var(--text); font-family:-apple-system, sans-serif; }
        
        /* ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Login */
        #liffLoginScreen { position:fixed; inset:0; z-index:20000; background:var(--bg); display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; }
        .btn-line { background:#06C755; color:white; border:none; padding:15px 30px; border-radius:15px; font-weight:bold; font-size:1.1rem; cursor:pointer; margin-top:20px; }

        /* ‡∏ï‡∏±‡∏ß‡πÅ‡∏≠‡∏õ */
        #appBody { display: none; flex-direction: column; min-height: 100vh; }
        .header { background:var(--white); padding:15px 20px; display:flex; align-items:center; justify-content:center; border-bottom:1px solid var(--border); position:sticky; top:0; }
        .header-title { font-weight: 800; font-size: 1.2rem; }
        
        .main-content { flex: 1; padding: 20px; }
        .panel { display:none; }
        .panel.active { display:block; }

        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ */
        .balance-section { text-align:center; padding:20px 0; }
        .bal-amount { font-size:3rem; font-weight:900; color:var(--pink); }

        .cat-table { background:var(--white); border-radius:24px; padding:10px; border:1px solid var(--border); margin-top:20px; }
        .cat-row { display:flex; align-items:center; padding:15px; border-bottom:1px solid #F5F5F7; }
        .cat-row:last-child { border-bottom:none; }

        /* Nav */
        .bottom-nav { position:fixed; bottom:0; left:0; right:0; height:var(--nav-h); background:var(--white); border-top:1px solid var(--border); display:grid; grid-template-columns:repeat(3,1fr); padding-bottom: env(safe-area-inset-bottom); }
        .nav-btn { display:flex; flex-direction:column; align-items:center; justify-content:center; background:none; border:none; color:var(--sub); font-size:0.7rem; font-weight:700; }
        .nav-btn.active { color:var(--pink); }
        
        .hidden { display:none !important; }
    </style>
</head>
<body>

<div id="liffLoginScreen">
    <div style="font-size: 5rem;">üêª</div>
    <h2 style="color:var(--pink);">Don Note</h2>
    <button class="btn-line" onclick="liff.login()">Login with LINE</button>
</div>

<div id="appBody">
    <div class="header">
        <span class="header-title" id="userNameTitle">Don Note ‚≠ê</span>
    </div>

    <div class="main-content">
        <div class="panel active" id="panel-home">
            <div class="balance-section">
                <div style="font-size:0.85rem; color:var(--sub);">‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                <div class="bal-amount" id="balAmount">‡∏ø0</div>
            </div>
            <div class="cat-table">
                <div class="cat-row">üí∞ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö <span style="margin-left:auto; font-weight:700;">‡∏ø0</span></div>
                <div class="cat-row">üí∏ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ <span style="margin-left:auto; font-weight:700;">‡∏ø0</span></div>
            </div>
        </div>
        <div class="panel" id="panel-add"><h3>‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3></div>
        <div class="panel" id="panel-history"><h3>‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h3></div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-btn active" onclick="goPanel('panel-home', this)">üè† ‡∏™‡∏£‡∏∏‡∏õ</button>
        <button class="nav-btn" onclick="goPanel('panel-add', this)">‚úèÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="nav-btn" onclick="goPanel('panel-history', this)">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    </nav>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAOAr6OsQpf_e-xv8qfLyIUu6Dant1MkS4",
    authDomain: "don-note.firebaseapp.com",
    projectId: "don-note",
    storageBucket: "don-note.firebasestorage.app",
    messagingSenderId: "661381674055",
    appId: "1:661381674055:web:0427dc17348fb11b56ed62"
};

if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const MY_LIFF_ID = "2009225343-VWodtDEA"; 

async function initLiff() {
    try {
        await liff.init({ liffId: MY_LIFF_ID });
        if (liff.isLoggedIn()) {
            const profile = await liff.getProfile();
            
            // ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            document.getElementById('liffLoginScreen').style.display = 'none';
            const app = document.getElementById('appBody');
            app.style.display = 'flex';
            
            document.getElementById('userNameTitle').textContent = profile.displayName + " ‚≠ê";
        } else {
            document.getElementById('liffLoginScreen').style.display = 'flex';
            document.getElementById('appBody').style.display = 'none';
        }
    } catch (err) {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
    }
}

function goPanel(id, btn) {
    document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
    document.getElementById(id).style.display = 'block';
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

window.onload = initLiff;
</script>
</body>
</html>
